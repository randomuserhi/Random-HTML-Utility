!function(){"use strict";let e=window.RHU;if(null==e)throw new Error("");e.module({module:"weak",trace:new Error,hard:["Map","WeakRef","WeakSet","FinalizationRegistry"]},(function(){let t=Map.prototype.set,o=Map.prototype.keys,i=Map.prototype.get;e.WeakRefMap=function(){return e.WeakRefMap.__reflect__.call(this,new.target,[])},e.WeakRefMap.__constructor__=function(){this._registry=new FinalizationRegistry((e=>{this.delete(e)}))},e.WeakRefMap.__reflect__=e.reflectConstruct(e.WeakRefMap,Map,e.WeakRefMap.__constructor__),e.WeakRefMap.prototype.set=function(e,o){return this._registry.register(o,e),t.call(this,e,new WeakRef(o))},e.WeakRefMap.prototype.get=function(t){let o=i.call(this,t);if(!e.exists(o))return;let l=o.deref();return e.exists(l)?l:void 0},e.WeakRefMap.prototype.values=function*(){for(let t of o.call(this)){let o=i.call(this,t).deref();e.exists(o)?yield o:this.delete(t)}},e.WeakRefMap.prototype[Symbol.iterator]=function*(){for(let t of o.call(this)){let o=i.call(this,t).deref();e.exists(o)?yield[t,o]:this.delete(t)}},e.inherit(e.WeakRefMap,Map);let l=WeakSet.prototype.add,r=WeakSet.prototype.delete;e.WeakCollection=function(){return e.WeakCollection.__reflect__.call(this,new.target,[])},e.WeakCollection.__constructor__=function(){this._collection=[],this._registry=new FinalizationRegistry((()=>{this._collection=this._collection.filter((t=>e.exists(t.deref())))}))},e.WeakCollection.__reflect__=e.reflectConstruct(e.WeakCollection,WeakSet,e.WeakCollection.__constructor__),e.WeakCollection.prototype.add=function(...e){for(let t of e)this.has(t)||(this._collection.push(new WeakRef(t)),l.call(this,t),this._registry.register(t))},e.WeakCollection.prototype.delete=function(...t){for(let e of t)r.call(this,e);this._collection=this._collection.filter((o=>(o=o.deref(),e.exists(o)&&!t.includes(o))))},e.WeakCollection.prototype[Symbol.iterator]=function*(){let t=this._collection;this._collection=[];for(let o of t)o=o.deref(),e.exists(o)&&(this._collection.push(new WeakRef(o)),yield o)},e.inherit(e.WeakCollection,WeakSet)}))}();
