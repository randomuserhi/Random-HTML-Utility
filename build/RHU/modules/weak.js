!function(){"use strict";let e=window.RHU;if(null==e)throw new Error("");e.module({module:"weak",trace:new Error,hard:["Map","WeakRef","WeakSet","FinalizationRegistry"]},(function(){let t=Map.prototype.set,i=Map.prototype.keys,o=Map.prototype.get;e.WeakRefMap=e.reflectConstruct(Map,"WeakRefMap",(function(){this._registry=new FinalizationRegistry((e=>{this.delete(e)}))})),e.WeakRefMap.prototype.set=function(e,i){return this._registry.register(i,e),t.call(this,e,new WeakRef(i))},e.WeakRefMap.prototype.get=function(t){let i=o.call(this,t);if(!e.exists(i))return;let l=i.deref();return e.exists(l)?l:void 0},e.WeakRefMap.prototype.values=function*(){for(let t of i.call(this)){let i=o.call(this,t).deref();e.exists(i)?yield i:this.delete(t)}},e.WeakRefMap.prototype[Symbol.iterator]=function*(){for(let t of i.call(this)){let i=o.call(this,t).deref();e.exists(i)?yield[t,i]:this.delete(t)}},e.inherit(e.WeakRefMap,Map);let l=WeakSet.prototype.add,r=WeakSet.prototype.delete;e.WeakCollection=e.reflectConstruct(WeakSet,"RHU.WeakCollection",(function(){this._collection=[],this._registry=new FinalizationRegistry((()=>{this._collection=this._collection.filter((t=>e.exists(t.deref())))}))})),e.WeakCollection.prototype.add=function(...e){for(let t of e)this.has(t)||(this._collection.push(new WeakRef(t)),l.call(this,t),this._registry.register(t))},e.WeakCollection.prototype.delete=function(...t){for(let e of t)r.call(this,e);this._collection=this._collection.filter((i=>(i=i.deref(),e.exists(i)&&!t.includes(i))))},e.WeakCollection.prototype[Symbol.iterator]=function*(){let t=this._collection;this._collection=[];for(let i of t)i=i.deref(),e.exists(i)&&(this._collection.push(new WeakRef(i)),yield i)},e.inherit(e.WeakCollection,WeakSet)}))}();
